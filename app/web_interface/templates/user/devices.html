<!-- web_interface/templates/user/devices.html -->
{% extends "base.html" %}
{% block title %}Appareils — B-CraftD{% endblock %}

{% block content %}
<h2>Appareils (sessions)</h2>
<div id="devices" class="bg-white p-4 shadow rounded"></div>
{% endblock %}

{% block scripts %}
<script>
(async ()=>{
  try{
    const res = await httpGetJson('/api/user/me/devices');
    const el = document.getElementById('devices');
    if (res.devices && res.devices.length){
      el.innerHTML = res.devices.map(d=>`<div class="p-2 border-b">${d.device_id} — ${new Date(d.created_at*1000).toLocaleString()} <button class="ml-2 btn" onclick="revokeDevice('${d.device_id}')">Révoquer</button></div>`).join('');
    } else {
      el.innerText = 'Aucun appareil connecté';
    }
  }catch(e){ console.error(e); document.getElementById('devices').innerText='Erreur'; }
})();
function revokeDevice(device_id){
  fetch('/api/user/me/devices/'+device_id+'/revoke', {method:'POST', headers: authHeaders()}).then(()=>location.reload());
}
</script>
{% endblock %}
